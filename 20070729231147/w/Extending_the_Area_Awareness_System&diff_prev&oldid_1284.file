







































<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>




		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="robots" content="noindex,follow" />
<meta name="keywords" content="Extending the Area Awareness System" />
<link rel="shortcut icon" href="/web/20070729231147im_/http://modwiki.net/favicon.ico" />
<link title="Creative Commons" type="application/rdf+xml" href="/w/index.php?title=Extending_the_Area_Awareness_System&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
		<title>Extending the Area Awareness System - modwiki</title>
		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/web/20070729231147cs_/http://modwiki.net/w/skins/monobook/main.css?9"; /*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="/web/20070729231147cs_/http://modwiki.net/w/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "/w/skins/monobook/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "/w/skins/monobook/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "/w/skins/monobook/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "/w/skins/monobook/IE70Fixes.css?1";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/w/skins/common/IEFixes.js"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		<script type="text/javascript">var skin = 'monobook';var stylepath = '/w/skins';</script>
		<script type="text/javascript" src="/web/20070729231147js_/http://modwiki.net/w/skins/common/wikibits.js?1"><!-- wikibits js --></script>
		<script type="text/javascript" src="/web/20070729231147js_/http://modwiki.net/w/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "/web/20070729231147cs_/http://modwiki.net/w/index.php?title=MediaWiki:Common.css&action=raw&ctype=text/css&smaxage=18000";
@import "/web/20070729231147cs_/http://modwiki.net/w/index.php?title=MediaWiki:Monobook.css&action=raw&ctype=text/css&smaxage=18000";
@import "/web/20070729231147cs_/http://modwiki.net/w/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
			</head>
<body  class="ns-0 ltr">
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script> if (window.archive_analytics) { window.archive_analytics.values['server_name']="wwwb-app16.us.archive.org";}; </script>

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1420070399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/modwiki.net\/w\/index.php?title=Extending_the_Area_Awareness_System&diff=prev&oldid=1284";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 475;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "29";
var displayMonth = "Jul";
var displayYear = "2007";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" lang="en" class="__wb_banner_div" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px">


<div id="wm-ipp-inside" class="__wb_banner_div" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=prev&amp;oldid=1284" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20070729231147" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;width: inherit !important" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Jun
                       
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 23:11:47 Jul 29, 2007">JUL</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Aug
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0" />
                       
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 23:11:47 Jul 29, 2007">29</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2006
                       
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 23:11:47 Jul 29, 2007">2007</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2008
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20070729231147*/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=prev&amp;oldid=1284" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>1 captures</strong></a>
           <div class="__wb_banner_div" style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">29 Jul 07 - 29 Jul 07</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:475px;height:27px;" href="" id="wm-graph-anchor">
       <div class="__wb_banner_div" id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:475px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="475"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=475_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:6:000000100000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000_2014:-1:000000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading">Extending the Area Awareness System</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From modwiki</h3>
			<div id="contentSub">(Difference between revisions)</div>
									<div id="jump-to-nav">Jump to: <a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=prev&amp;oldid=1284#column-one">navigation</a>, <a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=prev&amp;oldid=1284#searchInput">search</a></div>			<!-- start content -->
			
			<table border='0' width='98%' cellpadding='0' cellspacing='4' class='diff'>
			<tr>
				<td colspan='2' width='50%' align='center' class='diff-otitle'><strong><a href='/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;oldid=1221'>Revision as of 01:04, 14 August 2005</a></strong><br /><a href="/web/20070729231147/http://modwiki.net/wiki/User:Iceheart" title="User:Iceheart">Iceheart</a>  (<a href="/web/20070729231147/http://modwiki.net/wiki/User_talk:Iceheart" title="User talk:Iceheart">Talk</a> | <a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Special:Contributions&amp;target=Iceheart" title="Special:Contributions">contribs</a>)<br /> <span class='comment'>(Delete notice)</span><br /><a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=prev&amp;oldid=1221" title="Extending the Area Awareness System" id="differences-prevlink">? Previous diff</a></td>
				<td colspan='2' width='50%' align='center' class='diff-ntitle'><strong><a href='/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;oldid=1284'>Revision as of 02:05, 23 August 2005</a></strong><br /><a href="/web/20070729231147/http://modwiki.net/wiki/User:CusTom3" title="User:CusTom3">CusTom3</a>  (<a href="/web/20070729231147/http://modwiki.net/w/index.php?title=User_talk:CusTom3&amp;action=edit" class="new" title="User talk:CusTom3">Talk</a> | <a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Special:Contributions&amp;target=CusTom3" title="Special:Contributions">contribs</a>) <br /> <span class='comment'>(complete rewrite - tutorial on extending aas with code download)</span><br /><a href="/web/20070729231147/http://modwiki.net/w/index.php?title=Extending_the_Area_Awareness_System&amp;diff=next&amp;oldid=1284" title="Extending the Area Awareness System" id="differences-nextlink">Next diff →</a></td>
			</tr>
			<tr><td colspan="2" align="left"><strong>Line 1:</strong></td>
<td colspan="2" align="left"><strong>Line 1:</strong></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">{{delete|Not very informative, if someone shapes this </span>up <span class="diffchange">as a proper educational article, then it can stay</span>.<span class="diffchange">}}</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">I recently finished </span>up <span class="diffchange">some work extending the AAS system</span>. I <span class="diffchange">was able to add elevator and transporter capabilities to the navigation graph</span>. <span class="diffchange">With the changes below you can add the same ability for any AI character in doom 3 that you want to extend</span>.</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;b&gt;warning: fuzzy tired  brain dump ahead&lt;/b&gt;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange"> </span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>I <span class="diffchange">am currently working on .</span>..</td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">== adding ladder and elevator(lift) capability ==</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;b&gt;Is there any way to decrease tab indentation in code on the wiki?&lt;/b&gt;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;cite&gt;&quot;The Doom3 AAS compiler finds the following reachabilities:</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">== Overview ==</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_WALK</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">When doom 3 shipped it did so without support for elevators. So paths like the following resulted even though the elevator would be a better choice.</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_BARRIERJUMP</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">[[Image:bot_noelevator.jpg |none|thumb]]</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_WALKOFFLEDGE</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">What follows is an overview of how elevators capabilities were added and some tips if you want to incorporate this capability into your mod.</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_SWIM</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">== Setup Code ==</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_WATERJUMP</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">Each time a map is loaded you will need to call the routines to add the reachabilities to the AAS system. I had to reorganize just a little bit to make the map entities load before the AAS files were loaded and processed. </span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">TFL_FLY</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;cpp&gt;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">/*</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">===================</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">idGameLocal::LoadMap</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">although the swim </span>and <span class="diffchange">fly reachabilities are only calculated if in the AAS</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">Initializes all map variables common to both save games </span>and <span class="diffchange">spawned games.</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">settings &quot;allowSwimReachabilities&quot; and &quot;allowFlyReachabilities&quot; are set</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">===================</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">respectively. There tend to be a lot of fly reachabilities so we don't waste</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">*/</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">memory to store them if there are no flying creatures in a level.</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">void idGameLocal::LoadMap( const char *mapName, int randseed ) {</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">Since the Doom3 AAS format is very open and the environment sampling</span></td><td>+</td><td class='diff-addedline'>/<span class="diffchange">/ removed irrelevant code</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">functionality is exposed through idAASFile as well it shouldn't be too hard</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">for third parties to write a tool that adds more reachabilities to an AAS</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">file.&quot;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;</span>/<span class="diffchange">cite&gt;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">all i have to say about that is id software provides &lt;b&gt;amazing&lt;/b&gt; support to their modding community</span>.</td><td>+</td><td class='diff-addedline'><span class="diffchange">playerConnectedAreas</span>.<span class="diffchange">i = -1;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>so, <span class="diffchange">bots should really be able to use ladders and elevators or you end up with paths like:</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">#ifndef MOD_BOTS // cusTom3 - aas extensions - moved to later in InitFromNewMap </span>so <span class="diffchange">entities are spawned</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	int i;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	// load navigation system for all the different monster sizes</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	for( i = 0; i &lt; aasNames.Num(); i++ ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		aasList[ i ]-&gt;Init( idStr( mapFileName ).SetFileExtension( aasNames[ i ] ).c_str()</span>, <span class="diffchange">mapFile-&gt;GetGeometryCRC() );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">#endif</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">[[Image:bot_noelevator.jpg]]</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	// clear the smoke particle free list</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	smokeParticles-&gt;Init();&lt;/cpp&gt;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">my understanding is some of </span>the <span class="diffchange">ROE CTF maps require you </span>to <span class="diffchange">use a lift </span>to <span class="diffchange">get </span>to the <span class="diffchange">flag</span>.</td><td>+</td><td class='diff-addedline'><span class="diffchange">When </span>the <span class="diffchange">AAS files are loaded they need </span>to <span class="diffchange">have data added </span>to <span class="diffchange">them. In order </span>to <span class="diffchange">calculate that data </span>the <span class="diffchange">rest of the map needs to be loaded. Moving the AAS initialization to later in the process after MapPopulate takes care of this</span>.</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">i have started trying to implement adding the ladder and lift reachabilities to the aas system.</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;cpp&gt;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">/*</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">===================</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">idGameLocal::InitFromNewMap</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">===================</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">*/</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">void idGameLocal::InitFromNewMap( const char *mapName, idRenderWorld *renderWorld, idSoundWorld *soundWorld, bool isServer, bool isClient, int randseed ) {</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">the long term goal for this would be to make the additions to the aas with a console command, something like:</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">// removed irrelevant code</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;code&gt;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	MapPopulate();</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">botaas mymap</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;/code&gt;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">and presto you have a new </span>.<span class="diffchange">aas48 file or another </span>.<span class="diffchange">bot.aas48 file or something. this would put all the processing up front and not at run time</span>.</td><td>+</td><td class='diff-addedline'><span class="diffchange">#ifdef MOD_BOTS // cusTom3 - aas extensions - moved here from LoadMap so entities are spawned for botaas calculations</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	// load navigation system for all the different monster sizes</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	int i;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	for( i = 0; i &lt; aasNames</span>.<span class="diffchange">Num(); i++ ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		aasList[ i ]-&gt;Init( idStr( mapFileName )</span>.<span class="diffchange">SetFileExtension( aasNames[ i ] )</span>.<span class="diffchange">c_str(), mapFile-&gt;GetGeometryCRC() );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">#endif</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">to get started with that idea you need to be able to preprocess the map file and save your processing in the .aas48 file. this is what runaas does</span>.</td><td>+</td><td class='diff-addedline'><span class="diffchange">	mpGame</span>.<span class="diffchange">Reset();</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;/cpp&gt;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">To process </span>the <span class="diffchange">map information I added a call in gameLocal::InitFromNewMap:</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">When Init is called on each idAAS </span>the <span class="diffchange">actual work to find and add the extensions is done. For now the only file that is processed is the aas48 file. If someone wants to incorporate the player class changing code we could have bots with any model, and any AAS size. If you do this, you will need to change the check to include the appropriate extension.</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td> </td><td class='diff-context'>&lt;cpp&gt;</td><td> </td><td class='diff-context'>&lt;cpp&gt;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>#ifdef MOD_BOTS // cusTom3 - <span class="diffchange">add </span>aas <span class="diffchange">information </span>for <span class="diffchange">bots</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">/*</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">	</span>botAASBuilder.AddReachabilities();</td><td>+</td><td class='diff-addedline'><span class="diffchange">============</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">idAASLocal::Init</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">============</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">*/</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">bool idAASLocal::Init( const idStr &amp;mapName, unsigned int mapFileCRC ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	if ( file &amp;&amp; mapName.Icmp( file-&gt;GetName() ) == 0 &amp;&amp; mapFileCRC == file-&gt;GetCRC() ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		common-&gt;Printf( &quot;Keeping %s\n&quot;, file-&gt;GetName() );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		RemoveAllObstacles();</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	else {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		Shutdown();</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>&#160;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		file = AASFileManager-&gt;LoadAAS( mapName, mapFileCRC );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		if ( !file ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			common-&gt;DWarning( &quot;Couldn't load AAS file: '%s'&quot;, mapName.c_str() );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			return false;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>&#160;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>#ifdef MOD_BOTS // cusTom3 - aas <span class="diffchange">extensions </span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// TODO: don't need a builder unless it is a 48, but Init's </span>for <span class="diffchange">now, look at later</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// if class changing is added models could change, would have to handle that here</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		</span>botAASBuilder<span class="diffchange">-&gt;Init( this );</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		if (mapName</span>.<span class="diffchange">Find( &quot;aas48&quot;, false ) &gt; 0) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			botAASBuilder-&gt;</span>AddReachabilities();</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		}</span></td></tr>
<tr><td> </td><td class='diff-context'>#endif // TODO: save the new information out to a file so it doesn't have to be processed each map load</td><td> </td><td class='diff-context'>#endif // TODO: save the new information out to a file so it doesn't have to be processed each map load</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		SetupRouting();</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	}</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	return true;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>}</td></tr>
<tr><td> </td><td class='diff-context'>&lt;/cpp&gt;</td><td> </td><td class='diff-context'>&lt;/cpp&gt;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'> </td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>Just for reference botAASBuilder is declared in AAS_local.h as an instance of BotAASBuild, which had to get up close and personal to idAASLocal.</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">This is called after the map is loaded and ready to go. I started writing a method to only load the necessary information. This way I could move the compilation process to a console command that would run quickly and wouldn’t have to run each map load. But I gave up for now cause I will need to write a routine to save the changes back out to the aas file, and that routine is very low on my list of priorities. </span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;cpp&gt;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;b&gt;pray for a patch ;)&lt;</span>/<span class="diffchange">b&gt;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">class idAASLocal : public idAAS {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">#ifdef MOD_BOTS </span>/<span class="diffchange">/ cusTom3 - aas extensions</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	friend class BotAASBuild;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">#endif</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">I stuck that really bad </span>code <span class="diffchange">[[LoadMinimalMapStuff|over here]] for fun, maybe someone will fix it? So will you? he he.</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">// removed irrelevant </span>code</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange"> </span></td><td>+</td><td class='diff-addedline'>&#160;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">so to implement ladder reachabilities you would want </span>to <span class="diffchange">find each ladder in </span>the <span class="diffchange">map</span>. <span class="diffchange">Unfortunately I don’t know how to get at each brush face </span>in <span class="diffchange">the map </span>to <span class="diffchange">check its material </span>to <span class="diffchange">see if </span>it is <span class="diffchange">a ladder yet, but </span>I <span class="diffchange">am going to look at it soon</span>. <span class="diffchange">So you probably don’t even want </span>to <span class="diffchange">read </span>the <span class="diffchange">code routine below yet…</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">#ifdef MOD_BOTS // cusTom3 - aas extensions</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">private:	</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	BotAASBuild *				botAASBuilder;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">#endif</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;/cpp&gt;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>&#160;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">The call </span>to <span class="diffchange">AddReachabilities is where it gets fun. It turns out that </span>the <span class="diffchange">engine exe and the game dll have separate heaps</span>. <span class="diffchange">So </span>in <span class="diffchange">order </span>to <span class="diffchange">extend the AAS navigation graph I had </span>to <span class="diffchange">hack around some memory allocation issues. What </span>it <span class="diffchange">amounts to </span>is I <span class="diffchange">back up the original server allocated lists and replace them with my own dll allocated list</span>. <span class="diffchange">The original list data is appended </span>to the <span class="diffchange">local list, and now we are free to add as much data as we want.</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td> </td><td class='diff-context'>&lt;cpp&gt;</td><td> </td><td class='diff-context'>&lt;cpp&gt;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>void BotAASBuild::<span class="diffchange">TryToAddLadders</span>( void ) {</td><td>+</td><td class='diff-addedline'><span class="diffchange">/*</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">idAAS *aas</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">============</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">idAASFile *</span>file;</td><td>+</td><td class='diff-addedline'><span class="diffchange">BotAASBuild::AddReachabilities</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">const aasFace_t	*face</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">============</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">int numFaces</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">*/</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>void BotAASBuild::<span class="diffchange">AddReachabilities</span>( void ) {</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	// steal the portals list so i can manipulate it</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	originalPortals.list = file-&gt;portals.list</span>;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	<span class="diffchange">originalPortals.granularity = </span>file<span class="diffchange">-&gt;portals.granularity</span>;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	<span class="diffchange">originalPortals.num = file-&gt;portals.num</span>;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	<span class="diffchange">originalPortals.size = file-&gt;portals.size</span>;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	portals.Append(file-&gt;portals);</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	file-&gt;portals.list = portals.list;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">aas </span>= <span class="diffchange">gameLocal</span>.<span class="diffchange">GetAAS(&quot;aas48&quot;)</span>;</td><td>+</td><td class='diff-addedline'>	<span class="diffchange">originalPortalIndex.list </span>= <span class="diffchange">file-&gt;portalIndex</span>.<span class="diffchange">list</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">file </span>= <span class="diffchange">static_cast&lt; idAASLocal * </span>&gt;<span class="diffchange">( aas )</span>-&gt;file;</td><td>+</td><td class='diff-addedline'>	<span class="diffchange">originalPortalIndex.granularity </span>= <span class="diffchange">file-</span>&gt;<span class="diffchange">portalIndex.granularity;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	originalPortalIndex.num = file</span>-&gt;<span class="diffchange">portalIndex.num;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	originalPortalIndex.size = </span>file<span class="diffchange">-&gt;portalIndex.size</span>;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">// find all ladder surfaces in the map</span></td><td>+</td><td class='diff-addedline'>	<span class="diffchange">portalIndex.Append(file-&gt;portalIndex);</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">numFaces = </span>file-&gt;<span class="diffchange">GetNumFaces()</span>;</td><td>+</td><td class='diff-addedline'>	file-&gt;<span class="diffchange">portalIndex.list = portalIndex.list</span>;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">for </span>( <span class="diffchange">int i = 1</span>; <span class="diffchange">i &lt; numFaces; i++ ) {</span></td><td>+</td><td class='diff-addedline'>	<span class="diffchange">AddElevatorReachabilities</span>(<span class="diffchange">)</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		face = &amp;file-&gt;GetFace</span>( <span class="diffchange">i </span>);</td><td>+</td><td class='diff-addedline'><span class="diffchange">	AddTransporterReachabilities</span>();</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		</span>//<span class="diffchange">face-&gt;planeNum</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	</span>//<span class="diffchange">TryToAddLadders()</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		//file-&gt;planeList</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">	}</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">	</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'>}</td><td> </td><td class='diff-context'>}</td></tr>
<tr><td> </td><td class='diff-context'>&lt;/cpp&gt;</td><td> </td><td class='diff-context'>&lt;/cpp&gt;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">To find all the elevators in a map and add reachabilities to the aas file (in memory):</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">== Adding Elevator Reachabilities ==</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;b&gt; TODO: break </span>this <span class="diffchange">up </span>and <span class="diffchange">explain it someday &lt;/b&gt;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">The add AddElevatorReachabilies method became a MONSTER. There may be simpler implementations, but then again, </span>this <span class="diffchange">one started out simpler at one point too. I will only cover this routine at a high level, explaining some of the reasons for the design. I would suggest you read the comments </span>and <span class="diffchange">skim the code unless your are truly interested in the messy implementation.</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange"> </span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">My apologies for any formatting crapiness :( is there a way to get wiki not to indent so far???</span></td></tr>
<tr><td> </td><td class='diff-context'>&lt;cpp&gt;</td><td> </td><td class='diff-context'>&lt;cpp&gt;</td></tr>
<tr><td> </td><td class='diff-context'>/*</td><td> </td><td class='diff-context'>/*</td></tr>
<tr><td> </td><td class='diff-context'>============</td><td> </td><td class='diff-context'>============</td></tr>
<tr><td> </td><td class='diff-context'>BotAASBuild::AddElevatorReachabilities</td><td> </td><td class='diff-context'>BotAASBuild::AddElevatorReachabilities</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>cusTom3	- welcome to the longest, largest, monolithic beast i can ever credit myself to writing</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- the original idea started fairly simple as a port from the original q3 implementation</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- it just grew as different cases were tacked on, yes, it could use a rewrite with a simpler idea but...</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- favors reachabilties starting at outer edge of plat for navigation system usage.</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- if the top and bottom of the plat are in the same cluster reachabilities are created directly from top to bottom</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- if they are in different clusters and a portal exists between them the reachabilities use the portal</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- if there is no cluster portal this will try to create them</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		- TODO: should improve this logic to try areas for shared edges going up center trace</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	- look at using PushPointIntoAreaNum after PointReachableAreaNum - preliminary test didn't look good :(</td></tr>
<tr><td> </td><td class='diff-context'>============</td><td> </td><td class='diff-context'>============</td></tr>
<tr><td> </td><td class='diff-context'>*/</td><td> </td><td class='diff-context'>*/</td></tr>
<tr><td> </td><td class='diff-context'>void BotAASBuild::AddElevatorReachabilities( void ) {</td><td> </td><td class='diff-context'>void BotAASBuild::AddElevatorReachabilities( void ) {</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	// need the idAASLocal because we need non const areas and we call RemoveRoutingCacheUsingArea</td><td colspan="2">&nbsp;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	idAASLocal *aas;</td><td colspan="2">&nbsp;</td></tr>
<tr><td> </td><td class='diff-context'>	idAASFile *file;</td><td> </td><td class='diff-context'>	idAASFile *file;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	file = aas-&gt;file;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>	aas = static_cast&lt; idAASLocal * &gt;( gameLocal.GetAAS( &quot;aas48&quot; ) );</td><td colspan="2">&nbsp;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	file =  aas-&gt;file;</td><td colspan="2">&nbsp;</td></tr>
<tr><td>-</td><td class='diff-deletedline'></td><td colspan="2">&nbsp;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	// find all ladder surfaces in the map</td><td colspan="2">&nbsp;</td></tr>
<tr><td> </td><td class='diff-context'>	idEntity *ent;</td><td> </td><td class='diff-context'>	idEntity *ent;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	// for each entity in the map</td></tr>
<tr><td> </td><td class='diff-context'>	for ( ent = gameLocal.spawnedEntities.Next(); ent != NULL; ent = ent-&gt;spawnNode.Next() ) {</td><td> </td><td class='diff-context'>	for ( ent = gameLocal.spawnedEntities.Next(); ent != NULL; ent = ent-&gt;spawnNode.Next() ) {</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		// that is an elevator</td></tr>
<tr><td> </td><td class='diff-context'>		if ( ent-&gt;IsType( idPlat::Type ) ) {</td><td> </td><td class='diff-context'>		if ( ent-&gt;IsType( idPlat::Type ) ) {</td></tr>
<tr><td> </td><td class='diff-context'>			idPlat *platform = static_cast&lt;idPlat *&gt;(ent);</td><td> </td><td class='diff-context'>			idPlat *platform = static_cast&lt;idPlat *&gt;(ent);</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			idVec3 pos1, pos2;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;/cpp</span>&gt;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			pos1 = platform-</span>&gt;<span class="diffchange">GetPosition1();</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			pos2 = platform-&gt;GetPosition2();</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			int areaNum = aas-&gt;PointReachableAreaNum( pos1, file-&gt;GetSettings().boundingBoxes[0], travelFlags )</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">This is why we needed the map populated </span>;) <span class="diffchange"> this first part just says</span>, <span class="diffchange">find each platform…</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			int areaNum2 = aas-&gt;PointReachableAreaNum( pos2, file-&gt;GetSettings(</span>)<span class="diffchange">.boundingBoxes[0]</span>, <span class="diffchange">travelFlags );</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			// create </span>and <span class="diffchange">add a reachability</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">Then a bunch of variables </span>and <span class="diffchange">stuff</span>:</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			// TODO</span>: <span class="diffchange">should be checking for negative (portal area) here?</span></td><td>+</td><td class='diff-addedline'>&#160;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			aasArea_t *area = &amp;file-</span>&gt;<span class="diffchange">areas[ areaNum ];</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;cpp</span>&gt;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			</span>// <span class="diffchange">get the last reachability for the area</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	</span>// <span class="diffchange">TODO: play with how much to expand this</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			idReachability *reach </span>= <span class="diffchange">area</span>-&gt;<span class="diffchange">reach;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	idBounds bounds </span>= <span class="diffchange">model</span>-&gt;<span class="diffchange">GetAbsBounds</span>()<span class="diffchange">.Expand</span>( <span class="diffchange">0 </span>)<span class="diffchange">;</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			// OMG - BAD BOY – HOW LAZY AM I?</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">		</span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			idReachability *r = new idReachability</span>()<span class="diffchange">;</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	if </span>( <span class="diffchange">aas_showElevators.GetBool() </span>) {</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			if </span>( <span class="diffchange">reach </span>) <span class="diffchange">{</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">		gameRenderWorld</span>-&gt;<span class="diffchange">DebugBounds</span>( <span class="diffchange">colorGreen</span>, <span class="diffchange">bounds</span>, <span class="diffchange">vec3_origin, 200000 </span>);</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				// get to the last reach in the list - easier way?</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">                for </span>( <span class="diffchange">; reach-&gt;next; reach = reach-&gt;next </span>) {<span class="diffchange">}</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				r-&gt;rev_next = reach;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				r-&gt;number = reach-&gt;number + 1;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				reach-&gt;next = r;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			} </span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			else {</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				r-&gt;rev_next = NULL;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				r-&gt;number = 1;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">				area-&gt;reach = r;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			}</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;start = pos1;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;end = pos2;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;fromAreaNum = areaNum;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;toAreaNum = areaNum2;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;next = NULL;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;travelType = TFL_ELEVATOR;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			r-&gt;travelTime = 1;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			// routing cache is invalid? it indexes reachabilities</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			aas</span>-&gt;<span class="diffchange">RemoveRoutingCacheUsingArea</span>( <span class="diffchange">areaNum );</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			gameLocal.Printf( &quot;idPlat Position1: %s\nidPlat Position2: %s&quot;</span>, <span class="diffchange">platform-&gt;GetPosition1().ToString() </span>, <span class="diffchange">platform-&gt;GetPosition2().ToString() </span>);</td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		}</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'>	}</td><td> </td><td class='diff-context'>	}</td></tr>
<tr><td>-</td><td class='diff-deletedline'>}</td><td colspan="2">&nbsp;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>&lt;/cpp&gt;</td><td colspan="2">&nbsp;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">thanks to id for feedback on how to get this done ;</span>) <span class="diffchange">the algorithm is no where near complete. actually</span>, <span class="diffchange">because i don't manage memory properly a call later to FreeAAS causes an exception has caused the heap to become corrupt</span>, <span class="diffchange">he he. i will fix that later too. it has been proven possible to do this now</span>.</td><td>+</td><td class='diff-addedline'><span class="diffchange">	// top and bottom of plat (located in center, slightly above</span>)</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	idVec3 top</span>, <span class="diffchange">bottom</span>, <span class="diffchange">center;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	center = bounds</span>.<span class="diffchange">GetCenter();</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bottom = center;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bottom[2] = bounds[1][2] + 2; </span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	top = center;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	top[2] = bottom[2] + ( platform-&gt;GetPosition2()[2] - platform-&gt;GetPosition1()[2] ); </span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">[[Image:elevator_reach.gif]]</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	// start of possible reach (on bottom), end of possible reach (on top) and thier area and cluster numbers</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	idVec3 start, end;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	int topAreaNum, bottomAreaNum;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	int topClusterNum, bottomClusterNum;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	// for last ditch effort to create a reach</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	idVec3 bottomNeedPortal, topNeedPortal;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bool needPortal;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">I will come back to </span>the <span class="diffchange">above and update it when it is done. For now I am off to finish tearing apart RouteToGoalArea and the routing cache. this way we can get the reachabilities added used in the routing system.</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">	// check for portals going up </span>the <span class="diffchange">plat before processing</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	idVec3 firstPortal, lastPortal;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	int firstPortalNum, lastPortalNum;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	firstPortalNum = lastPortalNum = 0;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bool reachabilityCreated = false;</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">&lt;/cpp&gt;</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">== creating </span>and <span class="diffchange">executing paths which require secondary goals ==</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">The first thing the routine does when it finds a plat is trace up the “elevator shaft? to see if there are any cluster portals separating the top </span>and <span class="diffchange">bottom positions of the plat. if the trace finds one, it is stored for processing later, and we continue up in search of more. If it finds more it creates reachabilities to them now.</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>&lt;b&gt;TODO: section incomplete, write up jumping over a barrier talk about code below and checking for secondaryGoal&lt;/b&gt;</td><td colspan="2">&nbsp;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td> </td><td class='diff-context'>&lt;cpp&gt;</td><td> </td><td class='diff-context'>&lt;cpp&gt;</td></tr>
<tr><td>-</td><td class='diff-deletedline'>	<span class="diffchange">switch( reach-&gt;travelType ) {</span></td><td>+</td><td class='diff-addedline'><span class="diffchange">// look for portals up the elevator shaft and create reachabilities </span></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		case TFL_WALKOFFLEDGE:</span></td><td>+</td><td class='diff-addedline'>	<span class="diffchange">start </span>= <span class="diffchange">bottom</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.type </span>= <span class="diffchange">PATHTYPE_WALKOFFLEDGE</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bottomAreaNum </span>= <span class="diffchange">aas</span>-&gt;<span class="diffchange">PointReachableAreaNum( start, DefaultBotBounds(), travelFlags )</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.secondaryGoal </span>= <span class="diffchange">reach</span>-&gt;<span class="diffchange">end</span>;</td><td>+</td><td class='diff-addedline'><span class="diffchange">	bottomClusterNum </span>= <span class="diffchange">file</span>-&gt;<span class="diffchange">areas[bottomAreaNum]</span>.<span class="diffchange">cluster</span>;</td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.reachability = reach;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			break;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		case TFL_BARRIERJUMP:</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.type |= PATHTYPE_BARRIERJUMP;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.secondaryGoal </span>= <span class="diffchange">reach</span>-&gt;<span class="diffchange">end;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path</span>.<span class="diffchange">reachability = reach</span>;</td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			break;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		case TFL_JUMP:</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.type |= PATHTYPE_JUMP;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.secondaryGoal = reach-&gt;end;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.reachability = reach;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			break;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">#ifdef MOD_BOTS</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		case TFL_LADDER:</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			path.secondaryGoal = reach-&gt;end;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">#endif</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">		default:</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">			break;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">	}</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchange">&lt;/cpp&gt;</span></td><td>+</td><td class='diff-addedline'></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	// trace from bottom to top getting areas to look for portals</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	aasTrace_t trace;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	int areas[10];	</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	idVec3 points[10]; </td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	trace.maxAreas = 10;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	trace.areas = areas;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	trace.points = points;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	file-&gt;Trace( trace, bottom, top );</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	// for each area in trace (ignoring start area)</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>	for ( int q = 1; q &lt; trace.numAreas; q++ ) {</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		aasArea_t area = file-&gt;areas[trace.areas[q]]; </td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		// only want portal areas</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		if ( area.cluster &gt; 0 ) continue;</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		// trace is returning the same area 2 times in a row???</td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'>		if ( trace.areas[q] == trace.areas[q-1] ) continue;</td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'>== <span class="diffchange">Adding zone flags for </span>the <span class="diffchange">bots </span>==</td><td>+</td><td class='diff-addedline'><span class="diffchange">		aasPortal_t p </span>= <span class="diffchange">file-&gt;portals[-area.cluster];</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// make sure the portal just found is a portal to the bottom cluster (gets set to next bottom)</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// TODO: there is a possibility that an edge point around the bottom</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// is in a different cluster than the bottom center point and a usable portal would be missed</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		if ( bottomClusterNum &gt; 0 ) {</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			if( !( p.clusters[0] </span>=<span class="diffchange">= bottomClusterNum || p.clusters[1] == bottomClusterNum ) ) continue;	</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// would need an else if &lt; 0 here</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		else if ( bottomClusterNum &lt; 0 ) { // </span>the <span class="diffchange">bottom is also a portal - need to check that both portals share one cluster</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			aasPortal_t b </span>= <span class="diffchange">file-&gt;portals[-bottomClusterNum];</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">			if( !( p.clusters[0] </span>=<span class="diffchange">= b.clusters[0] || p.clusters[0] == b.clusters[1] || p.clusters[1] == b.clusters[0] || p.clusters[1] == b.clusters[1]) ) continue;	</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		}</span></td></tr>
<tr><td colspan="2">&nbsp;</td><td>+</td><td class='diff-addedline'><span class="diffchange">		// if it is 0, the center bottom of plat is out of bounds (d3ctf3 small circle plat)</span></td></tr>
<tr><td> </td><td class='diff-context'></td><td> </td><td class='diff-context'></td></tr>
<tr><td>-</td><td class='diff-deletedline'><span class="diffchang">




<!--
     FILE ARCHIVED ON 23:11:47 Jul 29, 2007 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 2:40:19 Oct 19, 2014.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
