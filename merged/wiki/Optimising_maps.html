<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>




		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="Optimising maps,Bind (console command),CFG (file format),Com showFPS (cvar),Console,DEMO (file format),ListImages (console command),Mapping,Models vs brushes,Patch,Quality settings" />
<link rel="shortcut icon" href="/favicon.ico" />
<link title="Creative Commons" type="application/rdf+xml" href="/w/index.php?title=Optimising_maps&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
		<title>Optimising maps - modwiki</title>
		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/w/skins/monobook/main.css?9"; /*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="/w/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "/w/skins/monobook/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "/w/skins/monobook/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "/w/skins/monobook/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "/w/skins/monobook/IE70Fixes.css?1";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/w/skins/common/IEFixes.js"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		<script type="text/javascript">var skin = 'monobook';var stylepath = '/w/skins';</script>
		<script type="text/javascript" src="/w/skins/common/wikibits.js?1"><!-- wikibits js --></script>
		<script type="text/javascript" src="/w/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "/w/index.php?title=MediaWiki:Common.css&action=raw&ctype=text/css&smaxage=18000";
@import "/w/index.php?title=MediaWiki:Monobook.css&action=raw&ctype=text/css&smaxage=18000";
@import "/w/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
			</head>
<body  class="ns-0 ltr">

	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading">Optimising maps</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From modwiki</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="/wiki/Optimising_maps#column-one">navigation</a>, <a href="/wiki/Optimising_maps#searchInput">search</a></div>			<!-- start content -->
			<p>The process of <b>map optimisation</b> ensures that a given map will play as fast and smoothly as possible on a wide range of hardware. Optimisation techniques are used both throughout the map design process and as a final stage prior to release. A map that is not optimised may perform slowly, cause unwanted visual artifacts, or even crash the game (or PC) in some extreme circumstances.
</p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Useful_Cvars"><span class="tocnumber">1</span> <span class="toctext">Useful Cvars</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Visportals"><span class="tocnumber">2</span> <span class="toctext">Visportals</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Shadows"><span class="tocnumber">3</span> <span class="toctext">Shadows</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Lighting"><span class="tocnumber">4</span> <span class="toctext">Lighting</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Geometry"><span class="tocnumber">5</span> <span class="toctext">Geometry</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#Textures"><span class="tocnumber">6</span> <span class="toctext">Textures</span></a></li>
<li class='toclevel-1'><a href="/wiki/Optimising_maps#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=1" title="Edit section: Useful Cvars">edit</a>]</div><a name="Useful_Cvars"></a><h2>Useful Cvars</h2>
<p>To test a <a href="/wiki/Mapping" title="Mapping">map</a> and gauge the performance there are several <a href="/wiki/Console" title="Console">CVars</a> that can be set or toggled to give you visual information about you map. You can type the <a href="/wiki/Bind_%28console_command%29" title="Bind (console command)">bind</a> console command at the console or set it in your "<a href="/wiki/CFG_%28file_format%29" title="CFG (file format)">autoexec.cfg</a>" file to make it a semi-permanent feature. For all CVars with multiple settings (instead of just on/off) you can use the <a href="/wiki/Toggle_%28console_command%29" title="Toggle (console command)">toggle</a> console command, for instance:
</p>
<pre>bind m toggle "<a href="/wiki/R_showTris_%28cvar%29" title="R showTris (cvar)">r_showTris</a> 0 1 2 3"
</pre>
<p>In general, the <a href="/wiki/Com_showFPS_%28cvar%29" title="Com showFPS (cvar)">com_showFps</a> allows you to keep tabs on the framerate of the current scene. It's not very useful to determining hardware bottlenecks though.
</p><p>After you've finished your map and are exclusively optimising the level it may pay off to <a href="/wiki/RecordDemo_%28console_command%29" title="RecordDemo (console command)">record</a> a .<a href="/wiki/DEMO_%28file_format%29" title="DEMO (file format)">DEMO</a> of you playing through and then benchmark it with the <a href="/wiki/TimeDemo_%28console_command%29" title="TimeDemo (console command)">timeDemo</a> function. This way you can more quickly and accurately see which parts need to be optimised.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=2" title="Edit section: Visportals">edit</a>]</div><a name="Visportals"></a><h2>Visportals</h2>
<p>By far the most important part in optimizing your maps is the correct usage of <a href="/wiki/Visportal" title="Visportal">visportals</a>, which tells the engine how to split up your map for rendering. If portals are not used properly, the engine may be rendering vast amounts of geometry which is not visible to the player, with an obviously devastating impact on performance.
</p><p><b>Maps must be designed from the start with portalisation in mind; attempting to retrofit portals into an existing map is a recipe for frustration.</b> Portalisation works best when a map is constructed in a "tunnel network" fashion, without excessive sightlines or large open areas with high polycounts.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=3" title="Edit section: Shadows">edit</a>]</div><a name="Shadows"></a><h2>Shadows</h2>
<p>By default, all brushes, models and patches cast shadows in the Doom 3 engine. For every shadow-casting object the engine must do several things: calculate the silhouette and extrude the shadowvolume (CPU-intensive), render the back of the shadow volume (GPU render pass) then render the front of the shadow volume (GPU render pass). This process must be repeated for every light for which this object casts a shadow.
</p><p>These extra render passes and shadowvolume calculations have a significantly detrimental effect on performance if sufficiently complex shadows are present in a scene. For this reason, eliminating unnecessary shadows is an important part of making smooth-running maps.
</p>
<ol><li> Consider which lights need to cast shadows: ambient or "fill-in" lights almost never need to be shadowcasters. Large, level-encompassing shadowcasting "moonlights" are particularly bad, and should be avoided if at all possible.
</li><li> Turn off shadows for individual models by using setting the "noshadows" key to "1". Although objects cast shadows by default, in many mapping situations there is no significant visual problem with turning them off. Level geometry constructed with brushes or patches can have shadows turned off by converting the structure into a <b>func_static</b> and setting the option as for a model.
</li><li> Make liberal use of the <b><a href="/wiki/R_showShadows_%28cvar%29" title="R showShadows (cvar)">r_showShadows</a></b> and <b><a href="/wiki/R_showShadowCount_%28cvar%29" title="R showShadowCount (cvar)">r_showShadowCount</a></b> CVARs during playtesting. <b>r_showShadowCount</b> colour-codes surfaces in much the same way as <b>r_showLightCount</b> -- if the screen turns white, there are far too many shadows in view.
</li><li> When designing a complex model, consider setting the model's main texture to non-shadowcasting (with the <b>noShadow</b> material keyword) and adding a separate, simpler "shadow mesh" to the model textured with "textures/common/shadow" or a similar shadowcasting texture. This means that the geometry used to calculate shadows is much simpler than the rendered visual model, which can improve performance without severely impacting the appearance.
</li><li> Animated lights or shadowvolumes are much slower than those cast by static models in a static lightsource, since the animated geometry cannot make use of the precomputed shadowvolumes added to the .proc file by the map compiler.
</li></ol>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=4" title="Edit section: Lighting">edit</a>]</div><a name="Lighting"></a><h2>Lighting</h2>
<p>The <a href="/wiki/R_showLightCount_%28cvar%29" title="R showLightCount (cvar)">r_showLightCount</a> CVar allows you to check how many lights are hitting each polygon. You can even make it a bindable toggle so that you can switch from disabled, to number of lights, to number of lights plus overdraw rate. 
</p><p>When viewing with <b>r_showLightCount,</b> surfaces in the game (and DoomEdit, although the editor colours are inaccurate) display a colour, representing the number of lights hitting a surface: black for none, red for 1, through green, blue, cyan, magenta and white for 6 or more. Large surfaces which excessive light-counts may cause a performance impact depending on their screen area, and in some cases it may improve performance to split the surfaces up along the light's volumes so that each surface is being hit by as few different light sources as possible.
</p><p>A word of warning: many of the beginner tutorials on Doom3World and other sites make a big issue out of light counts, giving the impression that massive performance drops will occur if a single surface ever has more than 3 lights hitting it, and suggesting that mappers spend large amounts of time carving brushes to reduce light counts. <b>This is not accurate</b>. On modern hardware, lightcounts are not the main performance bottleneck and carving a surface in order to reduce its lightcount from 4 to 3 is likely to achieve absolutely nothing. Well-designed portalling and reduced shadow counts are <b>far</b> more important for performance, and time should be spent in these areas rather than carving brushes.
</p><p>Note that the above warning applies specifically to brush carving; reducing the number of <i>actual lights</i> can still be beneficial, particularly if this reduces shadow counts as well.
</p><p>It can also be helpful to set both r_showTris and <a href="/wiki/R_showLightScissors_%28cvar%29" title="R showLightScissors (cvar)">r_showLightScissors</a> to "1" along with r_showLightCount. You could use the following:
</p>
<pre>bind l "toggle r_showLightCount 0 1; toggle r_showTris 0 1;toggle r_showLightScissors 0 1"
</pre>
<p>If you make use of <a href="/wiki/Patch" title="Patch">patches</a> then make sure surfaces behind them (which are not seen by the player) have the "caulk" material. Being single-sided meshes, they never block light so this will prevent the engine from having to waste time calculating per-pixel lighting on those the unseen surfaces.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=5" title="Edit section: Geometry">edit</a>]</div><a name="Geometry"></a><h2>Geometry</h2>
<p>The r_showTris CVar is helpful for gauging the amount of geometry being processed but it's more commonly used to acertain how your <a href="/wiki/Visportal" title="Visportal">visportals</a> are affecting performance. You should combine it with the following CVars:
</p>
<pre>bind p "toggle r_showTris 0 2;toggle <a href="/wiki/R_useScissor_%28cvar%29" title="R useScissor (cvar)">r_useScissor</a> 1 0;toggle <a href="/wiki/R_showPortals_%28cvar%29" title="R showPortals (cvar)">r_showPortals</a> 0 1"
</pre>
<p>See also the <a href="/wiki/Models_vs_brushes" title="Models vs brushes">models vs brushes</a> section.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=6" title="Edit section: Textures">edit</a>]</div><a name="Textures"></a><h2>Textures</h2>
<p>You can use the <a href="/wiki/ListImages_%28console_command%29" title="ListImages (console command)">listImages</a> console command to check how the texture memory utilization of your map compares to the official maps. Make sure you test at each of the <a href="/wiki/Quality_settings" title="Quality settings">quality settings</a>.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Optimising_maps&amp;action=edit&amp;section=7" title="Edit section: See also">edit</a>]</div><a name="See_also"></a><h2>See also</h2>
<ul><li><a href="/web/20111129220421/http://www.iddevnet.com/quake4/LevelEditor_Performance" class='external text' title="http://www.iddevnet.com/quake4/LevelEditor_Performance">iddevnet page on optimizing Q4 maps</a>
</li></ul>
<div class="printfooter">
Retrieved from "<a href="/wiki/Optimising_maps">http://www.modwiki.net/wiki/Optimising_maps</a>"</div>
			<div id="catlinks"><p class='catlinks'><a href="/w/index.php?title=Special:Categories&amp;article=Optimising_maps" title="Special:Categories">Category</a>: <span dir='ltr'><a href="/wiki/Category:Mapping" title="Category:Mapping">Mapping</a></span><br /><hr /><a href="/wiki/Category:Modwiki" title="Category:Modwiki">Modwiki</a> &gt; <a href="/wiki/Category:Mapping" title="Category:Mapping">Mapping</a></p></div>			<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<ul>
				 <li id="ca-nstab-main" class="selected"><a href="/wiki/Optimising_maps">Article</a></li>
				 <li id="ca-talk" class="new"><a href="/w/index.php?title=Talk:Optimising_maps&amp;action=edit">Discussion</a></li>
				 <li id="ca-edit"><a href="/w/index.php?title=Optimising_maps&amp;action=edit">Edit</a></li>
				 <li id="ca-history"><a href="/w/index.php?title=Optimising_maps&amp;action=history">History</a></li>
		</ul>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/w/index.php?title=Special:Userlogin&amp;returnto=Optimising_maps">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/web/20111129220421im_/http://www.modwiki.net/wiki/upload/wiki.png);" href="/wiki/Main_Page" title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-Main'>
		<h5>Main</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage"><a href="/wiki/Main_Page">Main Page</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-id Tech 4'>
		<h5>id Tech 4</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Doom-3"><a href="/wiki/Doom_3">Doom 3</a></li>
				<li id="n-Quake-4"><a href="/wiki/Quake_4">Quake 4</a></li>
				<li id="n-Prey"><a href="/wiki/Prey">Prey</a></li>
				<li id="n-ETQW"><a href="/wiki/Enemy_Territory:_Quake_Wars">ETQW</a></li>
				<li id="n-Wolfenstein"><a href="/wiki/Wolfenstein">Wolfenstein</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-id Tech 5'>
		<h5>id Tech 5</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Rage"><a href="/wiki/Rage">Rage</a></li>
				<li id="n-Doom-4"><a href="/wiki/Doom_4">Doom 4</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-Quick Links'>
		<h5>Quick Links</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Console"><a href="/wiki/Console">Console</a></li>
				<li id="n-Script-Events"><a href="/wiki/Scripting">Script Events</a></li>
				<li id="n-Material-Keywords"><a href="/wiki/Material_%28decl%29">Material Keywords</a></li>
				<li id="n-Modification-List"><a href="/wiki/Modlist">Modification List</a></li>
				<li id="n-Tutorial-List"><a href="/wiki/Tutorial_list">Tutorial List</a></li>
			</ul>
		</div>
	</div>
		<div class='portlet' id='p-Wiki'>
		<h5>Wiki</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Open-tasks"><a href="/wiki/modwiki:Open_tasks">Open tasks</a></li>
				<li id="n-recentchanges"><a href="/wiki/Special:Recentchanges">Recent changes</a></li>
				<li id="n-Style-guide"><a href="/wiki/modwiki:Style_guide">Style guide</a></li>
				<li id="n-help"><a href="/wiki/Help:Contents">Help</a></li>
			</ul>
		</div>
	</div>
		<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/wiki/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" type="text" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" value="Search" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/wiki/Special:Whatlinkshere/Optimising_maps">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/wiki/Special:Recentchangeslinked/Optimising_maps">Related changes</a></li>
<li id="t-upload"><a href="/wiki/Special:Upload">Upload file</a></li>
<li id="t-specialpages"><a href="/wiki/Special:Specialpages">Special pages</a></li>
				<li id="t-print"><a href="/w/index.php?title=Optimising_maps&amp;printable=yes">Printable version</a></li>				<li id="t-permalink"><a href="/w/index.php?title=Optimising_maps&amp;oldid=12556">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="/web/20111129220421/http://www.mediawiki.org/"><img src="/w/skins/common/images/poweredby_mediawiki_88x31.png" alt="MediaWiki" /></a></div>
				<div id="f-copyrightico"><a href="/web/20111129220421/http://www.gnu.org/copyleft/fdl.html"><img src="/w/skins/common/images/gnu-fdl.png" alt='GNU Free Documentation License 1.2' /></a></div>
			<ul id="f-list">
				<li id="lastmod"> This page was last modified 08:19, 20 April 2008.</li>
				<li id="copyright">Content is available under <a href="/web/20111129220421/http://www.gnu.org/copyleft/fdl.html" class='external ' title="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.2</a>.</li>
				<li id="privacy"><a href="/wiki/modwiki:Privacy_policy" title="modwiki:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="/wiki/modwiki:About" title="modwiki:About">About modwiki</a></li>
				<li id="disclaimer"><a href="/wiki/modwiki:General_disclaimer" title="modwiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
	<script type="text/javascript"> if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served by h982484 in 0.25 secs. -->
</body></html>





<!--
     FILE ARCHIVED ON 22:04:21 Nov 29, 2011 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 4:11:55 Oct 19, 2014.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
